test_that("capi() works", {
  
  
  # Positive returns, type 1-4 data -----------------------------------------
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="table",  
                       filterSummary=FALSE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="table",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=FALSE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=NULL,
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c(1:4),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  # Check geography types ---------------------------------------------------
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="us",
                       filterAddress=NULL,
                       filterRadius=NULL,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="state",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="county",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="tract",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  expect_s3_class(capi(year=year,
                       datatype="acs", 
                       dataset="acs5",   
                       tableID="B01001",   
                       variables=c("B01001_001","B01001_002"),
                       geography="block group",
                       filterAddress=address,
                       filterRadius=1,
                       ggr=NULL,
                       mode="summarize",  
                       filterSummary=TRUE,
                       filterSummaryLevels="root",
                       state=NULL,
                       county=NULL,
                       tract=NULL,
                       block_group=NULL,
                       verbose=verbose,
                       profile=FALSE,
                       st=NULL),"data.frame")
  
  # Start negative tests ----------------------------------------------------
  
  expect_warning(capi(year=year,
                      datatype="acs", 
                      dataset="acs5",   
                      tableID="B01001",   
                      variables=c("B01001_001","B01001_002"),
                      geography="us",
                      filterAddress=address,
                      filterRadius=1,
                      ggr=NULL,
                      mode="summarize",  
                      filterSummary=TRUE,
                      filterSummaryLevels="root",
                      state=NULL,
                      county=NULL,
                      tract=NULL,
                      block_group=NULL,
                      verbose=verbose,
                      profile=FALSE,
                      st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_warning(capi(year=year,
                      datatype="acs", 
                      dataset="acs5",   
                      tableID="B01001",   
                      variables=c("B01001_001","B01001_002"),
                      geography="us",
                      filterAddress=address,
                      filterRadius=1,
                      ggr=NULL,
                      mode="summarize",  
                      filterSummary=TRUE,
                      filterSummaryLevels="root",
                      state=NULL,
                      county=NULL,
                      tract=NULL,
                      block_group=NULL,
                      verbose=verbose,
                      profile=FALSE,
                      st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography=NULL,
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=NULL,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography=NULL,
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset=NULL,   
                    tableID=NULL,   
                    variables=NULL,
                    geography=NULL,
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID=NULL,   
                    variables="all",
                    geography=NULL,
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01002",   
                    variables="B01002_002",
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID=NULL,   
                    variables=c("B01001_001","B01001002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B02001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="BS02001",   
                    variables=c("BS01001_001","BS01001_002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID=NULL,   
                    variables=c("BS01001_001","BS01001_002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID=NULL,   
                    variables=c("B01009_001","B01009_002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B02001_002"),
                    geography="tract",
                    filterAddress=address,
                    filterRadius=1,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=88,
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state="IK",
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state="Wonderland",
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state="North",
                    county=NULL,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=17,
                    county=999,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=NULL,
                    county=043,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="tract",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=17,
                    county="Goober",
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
  
  expect_error(capi(year=year,
                    datatype="acs", 
                    dataset="acs5",   
                    tableID="B01001",   
                    variables=c("B01001_001","B01001_002"),
                    geography="region",
                    filterAddress=NULL,
                    filterRadius=NULL,
                    ggr=NULL,
                    mode="summarize",  
                    filterSummary=TRUE,
                    filterSummaryLevels="root",
                    state=36,
                    county=061,
                    tract=NULL,
                    block_group=NULL,
                    verbose=verbose,
                    profile=FALSE,
                    st=NULL))
})
